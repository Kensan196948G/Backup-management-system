#!/bin/bash
# ========================================
# æœ€çµ‚ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# systemdã‚µãƒ¼ãƒ“ã‚¹ã®èµ·å‹•ã®ã¿
# ========================================

set -e

cd /mnt/LinuxHDD/Backup-Management-System

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                                                â•‘"
echo "â•‘     ğŸš€ æœ€çµ‚ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— - ã‚µãƒ¼ãƒ“ã‚¹ã®èµ·å‹•                     â•‘"
echo "â•‘                                                                â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ã‚¹ãƒ†ãƒƒãƒ—1: ä¿®æ­£ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

sudo cp deployment/systemd/celery-worker-prod.service /etc/systemd/system/
echo "  âœ… celery-worker-prod.service"

sudo cp deployment/systemd/celery-beat-prod.service /etc/systemd/system/
echo "  âœ… celery-beat-prod.service"

sudo cp deployment/systemd/backup-management-production.service /etc/systemd/system/
echo "  âœ… backup-management-production.service"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ã‚¹ãƒ†ãƒƒãƒ—2: systemdãƒ‡ãƒ¼ãƒ¢ãƒ³ã®ãƒªãƒ­ãƒ¼ãƒ‰"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

sudo systemctl daemon-reload
echo "  âœ… systemd: ãƒªãƒ­ãƒ¼ãƒ‰å®Œäº†"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ã‚¹ãƒ†ãƒƒãƒ—3: ã‚µãƒ¼ãƒ“ã‚¹ã®èµ·å‹•"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

echo "Celery Workerã‚’èµ·å‹•ã—ã¦ã„ã¾ã™..."
sudo systemctl start celery-worker-prod
echo "  âœ… celery-worker-prod: èµ·å‹•å®Œäº†"

echo "Celery Beatã‚’èµ·å‹•ã—ã¦ã„ã¾ã™..."
sudo systemctl start celery-beat-prod
echo "  âœ… celery-beat-prod: èµ·å‹•å®Œäº†"

echo "ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¦ã„ã¾ã™..."
sudo systemctl start backup-management-production
echo "  âœ… backup-management-production: èµ·å‹•å®Œäº†"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ã‚¹ãƒ†ãƒƒãƒ—4: è‡ªå‹•èµ·å‹•ã®æœ‰åŠ¹åŒ–"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

sudo systemctl enable celery-worker-prod
echo "  âœ… celery-worker-prod: è‡ªå‹•èµ·å‹•è¨­å®šå®Œäº†"

sudo systemctl enable celery-beat-prod
echo "  âœ… celery-beat-prod: è‡ªå‹•èµ·å‹•è¨­å®šå®Œäº†"

sudo systemctl enable backup-management-production
echo "  âœ… backup-management-production: è‡ªå‹•èµ·å‹•è¨­å®šå®Œäº†"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ã‚¹ãƒ†ãƒƒãƒ—5: ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ã®ç¢ºèª"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

echo "ã€backup-management-productionã€‘"
if sudo systemctl is-active --quiet backup-management-production; then
    echo "  âœ… çŠ¶æ…‹: èµ·å‹•ä¸­"
else
    echo "  âš ï¸  çŠ¶æ…‹: åœæ­¢ä¸­"
fi

echo ""
echo "ã€celery-worker-prodã€‘"
if sudo systemctl is-active --quiet celery-worker-prod; then
    echo "  âœ… çŠ¶æ…‹: èµ·å‹•ä¸­"
else
    echo "  âš ï¸  çŠ¶æ…‹: åœæ­¢ä¸­"
fi

echo ""
echo "ã€celery-beat-prodã€‘"
if sudo systemctl is-active --quiet celery-beat-prod; then
    echo "  âœ… çŠ¶æ…‹: èµ·å‹•ä¸­"
else
    echo "  âš ï¸  çŠ¶æ…‹: åœæ­¢ä¸­"
fi

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                                                â•‘"
echo "â•‘        ğŸ‰ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸï¼                       â•‘"
echo "â•‘                                                                â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸŒ ã‚¢ã‚¯ã‚»ã‚¹URL"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "æœ¬ç•ªç’°å¢ƒ (HTTPS - æ¨å¥¨):"
echo "  ğŸŒ https://192.168.0.187:8443"
echo "  ğŸ“‹ ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯: [æœ¬ç•ª] Backup System"
echo ""
echo "æœ¬ç•ªç’°å¢ƒ (HTTP):"
echo "  ğŸŒ http://192.168.0.187:5000"
echo ""
echo "é–‹ç™ºç’°å¢ƒ:"
echo "  ğŸŒ http://192.168.0.187:5001"
echo "  ğŸ“‹ ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯: [é–‹ç™º] Backup System"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“Š ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†ã‚³ãƒãƒ³ãƒ‰"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "çŠ¶æ…‹ç¢ºèª:"
echo "  sudo systemctl status backup-management-production"
echo ""
echo "ãƒ­ã‚°ç¢ºèª:"
echo "  sudo journalctl -u backup-management-production -f"
echo ""
echo "å†èµ·å‹•:"
echo "  sudo systemctl restart backup-management-production"
echo ""
echo "åœæ­¢:"
echo "  sudo systemctl stop backup-management-production"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ https://192.168.0.187:8443 ã«ã‚¢ã‚¯ã‚»ã‚¹"
echo "2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Šã‚’æ‰¿èªï¼ˆè‡ªå·±ç½²åè¨¼æ˜æ›¸ã®ãŸã‚ï¼‰"
echo "3. ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³"
echo "4. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¸ãƒ§ãƒ–ã®ä½œæˆ"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

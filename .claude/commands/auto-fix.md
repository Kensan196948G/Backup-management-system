# 自動修復コマンド

直前のレビュー結果に基づき、「自動修復可能項目」のみを修正してください。

---

## 実行制約

### ✅ 修復可能な項目

以下の軽微な修正のみ実行してください：

1. **コードフォーマット**
   - インデント修正
   - 空白・改行の統一
   - import文の整理

2. **命名規則**
   - PEP 8違反の修正
   - タイポ修正
   - 命名規則の統一

3. **簡単なバグ修正**
   - 未使用変数の削除
   - 明白なタイポ修正
   - 簡単なロジックエラー

4. **ドキュメント**
   - docstringの追加
   - コメントの追加・修正

5. **軽微なリファクタリング**
   - 重複コードの統合
   - 変数名の改善

### ❌ 修復禁止項目

以下の変更は**絶対に禁止**です：

1. **設計変更**: アーキテクチャ・データベーススキーマ・API変更
2. **新規機能追加**: 要件にない機能の追加
3. **修復対象以外の変更**: レビューで指摘されていない箇所の変更
4. **破壊的変更**: 既存機能の削除や後方互換性を損なう変更
5. **セキュリティ関連の変更**: 認証・認可・暗号化ロジックの変更

---

## 実行手順

1. **直前のレビュー結果を確認**
   - 「自動修復可能項目」セクションを参照
   - 重大度を確認

2. **修復の優先順位**
   - 重大度Medium → 重大度Low の順に修復
   - 同じ重大度内では、影響範囲が小さいものから

3. **修復の実行**
   - 1つずつ慎重に修正
   - 各修正後、動作を確認

4. **修復結果の記録**
   - 何を修正したか
   - なぜ修正したか
   - どのように修正したか

---

## 出力形式

修復完了後、以下の形式で報告してください：

```markdown
## 🛠 自動修復完了レポート

### 修正概要
- **修正項目数**: X件
- **修正ファイル数**: X files
- **修正行数**: +X -X lines

---

### 修正内容

#### 1. [ファイル名] - [問題タイトル]
- **重大度**: [Medium/Low]
- **カテゴリ**: [バグ/フォーマット/命名規則/ドキュメント/リファクタリング]
- **修正箇所**: 行番号 X-Y
- **修正前**:
  ```python
  # 修正前のコード
  ```
- **修正後**:
  ```python
  # 修正後のコード
  ```
- **修正理由**: 
  なぜこの修正が必要だったか
- **影響範囲**: 
  この修正による影響

#### 2. [次の修正項目]
[同様の形式で記載]

---

### 修正ファイル一覧

- `path/to/file1.py` - X箇所修正
- `path/to/file2.py` - Y箇所修正
- `path/to/file3.md` - Z箇所修正

---

### テスト結果

- [x] 構文エラーなし
- [x] インポートエラーなし
- [x] 既存テストの実行確認（必要な場合）
- [ ] 追加テストの実行（該当する場合）

---

### 残存問題

修復できなかった項目（手動対応が必要）：

#### 重大度High
1. **[問題タイトル]**
   - ファイル: `path/to/file.py`
   - 理由: [自動修復できない理由]
   - 推奨対応: [人間が行うべき対応]

#### 重大度Medium
1. **[問題タイトル]**
   - ファイル: `path/to/file.py`
   - 理由: [自動修復できない理由]
   - 推奨対応: [人間が行うべき対応]

---

### 次のアクション

[残存問題がない場合]
✅ 全ての自動修復可能項目を修正完了
✅ 再レビューを実行してください: `/review-all`

[残存問題がある場合]
⚠️ 以下の手動対応が必要です：
1. [対応項目1]
2. [対応項目2]

手動対応完了後、再度 `/review-all` を実行してください。

---

### 修復統計

- **成功**: X件
- **スキップ（修復不要）**: Y件
- **失敗（手動対応必要）**: Z件
- **実行時間**: X分Y秒
```

---

## 安全性確保

### 修復前の確認
- [ ] レビュー結果で「自動修復可能」と明記されている
- [ ] 修復内容がCLAUDE.mdのポリシーに準拠
- [ ] 影響範囲を理解している

### 修復中の注意
- [ ] 1つずつ慎重に修正
- [ ] 修復対象以外は変更しない
- [ ] 構文エラーが発生しないことを確認

### 修復後の確認
- [ ] 差分を確認（`git diff`）
- [ ] 構文チェック（Python: `python -m py_compile`）
- [ ] 簡易テスト実行

---

## エラーハンドリング

修復中にエラーが発生した場合：

1. **即座に停止**: それ以上の修復を行わない
2. **エラー報告**: 何が起きたかを詳細に報告
3. **ロールバック提案**: 修正を元に戻す方法を提示
4. **人間への引き継ぎ**: 手動対応を依頼

---

## 実行例

### ケース1: コードフォーマット修正

**修正前**:
```python
def hello(name):
x=5
if x>3:
  return name
```

**修正後**:
```python
def hello(name):
    x = 5
    if x > 3:
        return name
```

**理由**: PEP 8準拠のためインデントと空白を修正

---

### ケース2: 未使用変数の削除

**修正前**:
```python
def calculate(a, b):
    unused_var = 10
    result = a + b
    return result
```

**修正後**:
```python
def calculate(a, b):
    result = a + b
    return result
```

**理由**: 未使用変数を削除してコードを簡潔化

---

### ケース3: docstringの追加

**修正前**:
```python
def process_data(data):
    return data.strip().lower()
```

**修正後**:
```python
def process_data(data):
    """
    データを正規化する（空白削除・小文字化）
    
    Args:
        data (str): 処理対象の文字列
        
    Returns:
        str: 正規化された文字列
    """
    return data.strip().lower()
```

**理由**: 関数の目的を明確にするためdocstringを追加

---

## 重要な注意事項

1. **慎重に実行**: 自動修復といえども慎重に
2. **範囲を守る**: レビューで指摘された箇所のみ
3. **記録を残す**: すべての変更を詳細に記録
4. **テストを実行**: 修復後は必ず動作確認
5. **疑問があれば停止**: 不明な点があれば人間に確認

---

## 実行

上記の制約と手順に従って、自動修復を実行してください。

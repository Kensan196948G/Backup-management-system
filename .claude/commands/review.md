# コードレビューコマンド

変更されたコードを自動的にレビューして、改善提案を行います。

## 📋 概要

このコマンドは、git diffを使用して変更を分析し、以下の観点からレビューします：

## 🔍 レビュー観点

### 1. コード品質
- コードの可読性
- 命名規則の遵守
- 関数/クラスのサイズ
- 複雑度

### 2. セキュリティ
- SQLインジェクション
- XSS脆弱性
- 認証・認可の適切性
- 機密情報の漏洩

### 3. パフォーマンス
- 不要なループ
- データベースクエリの最適化
- メモリ使用の効率性
- アルゴリズムの選択

### 4. テスト
- テストの存在
- テストカバレッジ
- エッジケースの考慮

### 5. ドキュメント
- コメントの適切性
- docstringの存在
- READMEの更新

## 🚀 実行フロー

### ステップ1: 変更の確認

```bash
# 変更されたファイルを確認
git diff --name-only

# 詳細な差分を取得
git diff
```

### ステップ2: 自動レビュー

各変更について、以下をチェック：

1. **構文チェック**: flake8, black
2. **型チェック**: mypy
3. **セキュリティスキャン**: bandit
4. **複雑度分析**: radon

### ステップ3: レビューレポート作成

## 📊 レビューレポート形式

```markdown
# コードレビューレポート

## 変更サマリー
- **変更ファイル数**: 5
- **追加行数**: +234
- **削除行数**: -87
- **総合評価**: B+

## ファイル別レビュー

### app/backup.py
**評価**: A-

✅ **良い点**:
- エラーハンドリングが適切
- ロギングが充実
- テストが追加されている

⚠️ **改善提案**:
1. `create_backup()` 関数が長すぎる（85行）
   - 推奨: 複数の小さな関数に分割
2. 型アノテーションが不足
   - 行123-145: 引数と戻り値に型を追加

💡 **セキュリティ**:
- 行67: ユーザー入力を直接パスに使用
  - 推奨: `os.path.join()` とパス検証を使用

### app/restore.py
**評価**: B

✅ **良い点**:
- 適切な抽象化
- ドキュメントが充実

⚠️ **改善提案**:
1. エラーハンドリングが不足
   - 行34: FileNotFoundError をキャッチすべき
2. パフォーマンス懸念
   - 行89-92: ループ内でDB クエリ
   - 推奨: バルククエリに変更

## セキュリティ警告

🔴 **重大**: app/api.py:45
- SQLインジェクションの可能性
- 修正方法: プリペアドステートメント使用

🟡 **注意**: app/auth.py:123
- ハードコードされた秘密鍵
- 修正方法: 環境変数に移動

## 推奨アクション

### 必須（修正してからコミット）
1. [ ] SQLインジェクション脆弱性の修正
2. [ ] ハードコードされた秘密鍵の削除

### 推奨（できれば修正）
1. [ ] 長い関数の分割
2. [ ] 型アノテーションの追加
3. [ ] エラーハンドリングの改善

### オプション（将来的に）
1. [ ] パフォーマンス最適化
2. [ ] ドキュメントの拡充
```

## ⚙️ カスタマイズ

### レビュー対象の指定

```bash
# 特定のコミットとの比較
git diff HEAD~1

# 特定のブランチとの比較
git diff main...feature-branch

# ステージングエリアとの比較
git diff --staged
```

### レビュー厳格度

**厳格**: すべての警告を報告
**標準**: 重要な警告のみ
**緩い**: エラーのみ

## 🔧 自動修正

レビューで指摘された項目の一部は自動修正可能：

```bash
# フォーマット
black .

# インポート順序
isort .

# 簡単なLint問題
autopep8 --in-place --aggressive .
```

## 💡 ベストプラクティス

1. **早期レビュー**: コミット前に実行
2. **段階的改善**: 一度に全て修正しない
3. **優先順位**: セキュリティ > バグ > スタイル
4. **学習**: 繰り返されるパターンから学ぶ

## 🔗 関連コマンド

- `/analyze` - コード全体の分析
- `/commit` - レビュー後のコミット
- `/test` - テスト実行

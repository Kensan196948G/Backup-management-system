# 機能仕様書

**プロジェクト名:** バックアップ管理システム WebUI
**バージョン:** 1.0.0
**作成日:** 2026-02-25

---

## 1. 概要

本文書は、バックアップ管理システム WebUI の各機能について、詳細な動作仕様を定義します。

---

## 2. ダッシュボード機能

### 2.1 サマリーカード

**概要:** システム全体のバックアップ状況を一目で把握できるカードウィジェット群。

**表示項目:**

| カード名 | 表示内容 | 更新タイミング |
|---------|---------|--------------|
| 成功ジョブ数 | 直近 24h の成功件数（緑） | 30 秒ごと |
| 失敗ジョブ数 | 直近 24h の失敗件数（赤） | 30 秒ごと |
| 実行中ジョブ数 | 現在実行中の件数（青） | リアルタイム |
| ストレージ使用率 | 使用量 / 総容量（%） | 5 分ごと |

**動作仕様:**
- カードクリックで対応するジョブ一覧にフィルタリング遷移する
- 失敗件数が 0 以上の場合、赤バッジをタブタイトルに表示する
- ストレージ使用率が 80% を超えた場合、警告色（オレンジ）に変化する

### 2.2 バックアップタイムライン

**概要:** 直近 24 時間のバックアップ実行結果を時系列で表示。

**仕様:**
- X 軸：時刻（0〜24 時間、1 時間刻み）
- Y 軸：ジョブ名
- バーの色：成功（緑）/ 失敗（赤）/ 実行中（青・点滅）/ スキップ（グレー）
- バーにホバーすると詳細ツールチップを表示
- 期間フィルタ：24h / 7d / 30d の切り替え

---

## 3. バックアップジョブ管理機能

### 3.1 ジョブ一覧画面

**テーブル列定義:**

| 列名 | データ型 | ソート | フィルタ |
|------|---------|--------|---------|
| ジョブ名 | string | ○ | 部分一致 |
| ステータス | enum | ○ | 選択式 |
| 最終実行日時 | datetime | ○ | 日付範囲 |
| 次回実行予定 | datetime | ○ | - |
| 所要時間 | duration | ○ | - |
| バックアップサイズ | bytes | ○ | - |
| 操作 | actions | - | - |

**ページネーション:** デフォルト 25 件/ページ（10 / 25 / 50 / 100 切り替え可能）

**バルク操作:**
- 複数選択チェックボックス
- 一括実行 / 一括無効化 / 一括削除

### 3.2 ジョブ作成ウィザード

**ステップ 1: 基本設定**
- ジョブ名（必須・最大 100 文字・英数字・ハイフン・アンダースコア）
- 説明（任意・最大 500 文字）
- バックアップ種別（フル / 差分 / 増分）

**ステップ 2: ソース設定**
- バックアップ対象の選択（ファイル / フォルダ / ボリューム / VM）
- 除外パターンの設定（glob 形式）

**ステップ 3: 保存先設定**
- ストレージプールの選択
- 保持ポリシー（世代数 / 保持日数）
- 暗号化オプション（AES-256）

**ステップ 4: スケジュール設定**
- 手動実行のみ / スケジュール実行の選択
- cron 式またはウィザード形式での設定
- タイムゾーン選択

**ステップ 5: 通知設定**
- 通知条件（常に / 失敗時のみ / 成功時のみ）
- 通知先（Email / Teams）

**バリデーション:**
- 各ステップで入力チェックを実施
- エラーはインライン表示
- 前のステップへの戻り時に入力値を保持

### 3.3 ジョブ詳細画面

**表示タブ:**

1. **概要** - 基本情報・最終実行結果・統計グラフ
2. **実行履歴** - 過去の実行ログ一覧（最大 90 日間）
3. **設定** - ジョブ設定の表示・編集
4. **通知** - 通知設定の表示・編集

---

## 4. 監視・アラート機能

### 4.1 リアルタイム監視

- WebSocket を使用したリアルタイム更新
- 実行中ジョブの進捗バー（0〜100%）
- 転送速度・残り時間の表示
- ログストリーミング（最新 1000 行）

### 4.2 アラートルール

**ルール設定項目:**

| 項目 | 説明 |
|------|------|
| トリガー条件 | ジョブ失敗 / 実行時間超過 / ストレージ警告 |
| 閾値 | 数値・パーセンテージ |
| 通知チャネル | Email / Teams / Webhook |
| クールダウン | 同一アラートの再通知抑制時間 |
| 重要度 | Critical / Warning / Info |

---

## 5. レポート機能

### 5.1 レポート種別

| 種別 | 説明 | スケジュール対応 |
|------|------|----------------|
| 日次レポート | 当日のバックアップ実行サマリー | ○（毎日 AM 8:00） |
| 週次レポート | 7 日間の統計・トレンド | ○（毎週月曜） |
| 月次レポート | 月間統計・コンプライアンスサマリー | ○（毎月 1 日） |
| カスタムレポート | 期間・項目を自由指定 | ○ |

### 5.2 エクスポート仕様

- **CSV:** UTF-8 BOM 付き、ヘッダー行あり
- **PDF:** A4 縦向き、企業ロゴ・ページ番号付き
- ファイル名規則: `backup-report_{type}_{YYYYMMDD}.{ext}`

---

## 6. ユーザー管理機能

### 6.1 ロール定義

| ロール | ダッシュボード | ジョブ管理 | レポート | ユーザー管理 | システム設定 |
|--------|--------------|-----------|---------|------------|------------|
| Admin | 読取/書込 | 読取/書込 | 読取/書込 | 読取/書込 | 読取/書込 |
| Operator | 読取/書込 | 読取/書込 | 読取 | - | - |
| Viewer | 読取 | 読取 | 読取 | - | - |

### 6.2 ユーザー管理操作

- **作成:** メールアドレス・表示名・初期パスワード・ロール
- **編集:** 表示名・ロール・ステータス（有効/無効）
- **パスワードリセット:** 管理者による強制リセット（メール送信）
- **削除:** ソフトデリート（90 日後に物理削除）

---

## 更新履歴

| 日付 | バージョン | 更新者 | 内容 |
|------|-----------|--------|------|
| 2026-02-25 | 1.0.0 | システム管理者 | 初版作成 |
